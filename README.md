# Meta-Prompt Optimizer Bot

Telegram-бот для улучшения и создания промптов для LLM. Два режима: **простой** (улучшение за один запрос) и **агент** (диалог с памятью, уточняющие вопросы с кнопками). LLM через [OpenRouter](https://openrouter.ai): DeepSeek, ChatGPT, Gemini, Grok 4 Fast, Mistral Nemo, Xiaomi Mimo V2 Flash.

## Возможности

- **Простой режим** — отправь промпт, получи улучшенный вариант в блоке цитаты и моноширины (копирование по нажатию), метрики длины и слов.
- **Режим агента** — диалог с памятью (последние 16 сообщений); агент оценивает сложность запроса и либо сразу даёт промпт, либо задаёт 1–5 уточняющих вопросов с кнопками выбора; после ответов формирует промпт. Кнопка **«Принять промпт»** обнуляет историю и отделяет сессию.
- **Предпочтения** — при первом входе бот задаёт 3 вопроса (стиль ответов, цели использования ИИ до 4 вариантов, формат промптов); предпочтения хранятся в БД; их можно изменить в настройках → Кастомизация.
- **Выбор LLM** — DeepSeek, ChatGPT, Gemini, Grok 4 Fast (xAI), Mistral Nemo, Xiaomi Mimo V2 Flash через один API OpenRouter.
- **Кастомизация** — в настройках отдельная кнопка: предпочтения, meta-промпт, контекст и **температура** (влияет на стабильность и разнообразие ответов модели).
- **Метрики в агенте** — длина и слова (исходный vs последний вариант), ROUGE (похожесть), краткое объяснение «почему может быть лучше».

## Технический стек

- Python 3.10+
- aiogram 3.x
- OpenRouter API (один ключ для всех моделей)
- SQLite (настройки пользователей, температура, история агента)
- rouge-score (метрики для агента)

## Установка

1. Клонируйте репозиторий.

2. Установите зависимости:
```bash
pip install -r requirements.txt
```

3. Создайте `.env` (по образцу `env_example.txt`):
   - **TELEGRAM_BOT_TOKEN** — токен от [@BotFather](https://t.me/BotFather)
   - **OPENROUTER_API_KEY** — ключ с [OpenRouter](https://openrouter.ai/keys)

## Запуск

Локально:
```bash
python -m bot.main
```

Docker (Linux-сервер):
```bash
# Соберите образ и запустите с .env в текущей папке
docker compose up -d --build

# Или без docker-compose: передайте переменные вручную
docker build -t prompt-optimizer-bot .
docker run -d --restart unless-stopped --env-file .env -v prompt_bot_data:/app prompt-optimizer-bot
```
База SQLite сохраняется в volume `bot_data` (путь в контейнере: `/app/data/bot.db`). Создайте `.env` по образцу `env_example.txt` с `TELEGRAM_BOT_TOKEN` и `OPENROUTER_API_KEY`.

## Использование

1. `/start` — при первом входе 3 вопроса о предпочтениях, затем приветствие.
2. Отправь промпт: в **простом** режиме — улучшенный промпт в блоке и метрики; в **режиме агента** — ответ с учётом истории, возможно уточняющие вопросы с кнопками, затем промпт с метриками и ROUGE; кнопка «Принять промпт» завершает сессию.
3. `/settings` — LLM, режим, **Кастомизация** (предпочтения, meta-промпт, контекст, температура).

## Команды

- `/start` — приветствие
- `/help` — справка
- `/settings` — настройки (LLM, режим, кастомизация)

## Особенности

- Один API OpenRouter для нескольких моделей.
- Предпочтения и температура хранятся в БД и используются при вызовах LLM.
- В режиме агента хранятся последние 16 сообщений диалога (скользящее окно).
- Улучшенный промпт выводится в блоке цитаты и моноширины (копирование по нажатию в Telegram).
